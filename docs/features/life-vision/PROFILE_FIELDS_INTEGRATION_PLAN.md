# Profile Fields Integration Plan

**Last Updated:** November 29, 2024  
**Status:** In Progress

## Overview

Integrate all user profile fields (clarity, dream, contrast, worry) into the V3 Life Vision creation flow with a vibrant color-coded system.

## Color System

| Field Type | Color | Hex | Meaning |
|------------|-------|-----|---------|
| **Clarity From Profile** | Neon Cyan | `#00FFFF` | What's going well + Dreams/Aspirations |
| **Contrast from Profile** | Neon Red | `#FF0040` | What's not working + Worries/Concerns |
| **Clarity from Contrast** | Premium Purple | `#BF00FF` | AI-generated clarity flipped from contrast |

## Profile Fields by Category

Each of the 12 categories has 4 profile fields:

1. **`clarity_[key]`** - "What's going well?" (user-written)
2. **`dream_[key]`** - "What do you dream about?" (user-written)
3. **`contrast_[key]`** - "What's not working?" (user-written)
4. **`worry_[key]`** - "What worries you?" (user-written)

**Example for `fun` category:**
- `clarity_fun` - "I love playing guitar on weekends"
- `dream_fun` - "I dream of having more time for creative hobbies"
- `contrast_fun` - "I barely have time for hobbies anymore"
- `worry_fun` - "I'm worried I'll lose touch with what makes me happy"

## Display Structure

### On `/life-vision/new/category/[key]` Page

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Clarity From Profile (Neon Cyan #00FFFF)                â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚ ğŸ’ What's Going Well                               â”‚  â”‚
â”‚     â”‚ clarity_[key] content...                           â”‚  â”‚
â”‚     â”‚                                                    â”‚  â”‚
â”‚     â”‚ âœ¨ Your Dreams & Aspirations                       â”‚  â”‚
â”‚     â”‚ dream_[key] content...                             â”‚  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Contrast from Profile (Neon Red #FF0040)                â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚ âš ï¸ What's Not Working                              â”‚  â”‚
â”‚     â”‚ contrast_[key] content...                          â”‚  â”‚
â”‚     â”‚                                                    â”‚  â”‚
â”‚     â”‚ ğŸ˜° Your Worries & Concerns                         â”‚  â”‚
â”‚     â”‚ worry_[key] content...                             â”‚  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Clarity from Contrast (Premium Purple #BF00FF)          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚ ğŸ”® AI-Generated Clarity (from your contrast)       â”‚  â”‚
â”‚     â”‚ [Auto-generated by VIVA from contrast + worry]     â”‚  â”‚
â”‚     â”‚                                                    â”‚  â”‚
â”‚     â”‚ "Based on your contrast about X, the clarity is   â”‚  â”‚
â”‚     â”‚ that you value Y and desire Z..."                  â”‚  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Architecture

### 1. ProfileClarityCard (Cyan)

```tsx
<Card 
  variant="outlined" 
  className="border-[#00FFFF] bg-[#00FFFF]/5"
>
  <div className="flex items-center gap-2 mb-3">
    <div className="w-8 h-8 bg-[#00FFFF]/20 rounded-lg flex items-center justify-center">
      <Sparkles className="w-5 h-5 text-[#00FFFF]" />
    </div>
    <h3 className="text-lg font-semibold text-[#00FFFF]">
      Clarity From Profile
    </h3>
  </div>
  
  {clarityText && (
    <div className="mb-4">
      <p className="text-xs text-[#00FFFF]/70 mb-1">ğŸ’ What's Going Well</p>
      <p className="text-neutral-200">{clarityText}</p>
    </div>
  )}
  
  {dreamText && (
    <div>
      <p className="text-xs text-[#00FFFF]/70 mb-1">âœ¨ Your Dreams</p>
      <p className="text-neutral-200">{dreamText}</p>
    </div>
  )}
  
  {!clarityText && !dreamText && (
    <p className="text-neutral-400 text-sm">
      No clarity or dreams recorded yet. This will help VIVA understand your aspirations.
    </p>
  )}
</Card>
```

### 2. ProfileContrastCard (Red)

```tsx
<Card 
  variant="outlined" 
  className="border-[#FF0040] bg-[#FF0040]/5"
>
  <div className="flex items-center gap-2 mb-3">
    <div className="w-8 h-8 bg-[#FF0040]/20 rounded-lg flex items-center justify-center">
      <AlertTriangle className="w-5 h-5 text-[#FF0040]" />
    </div>
    <h3 className="text-lg font-semibold text-[#FF0040]">
      Contrast from Profile
    </h3>
  </div>
  
  {contrastText && (
    <div className="mb-4">
      <p className="text-xs text-[#FF0040]/70 mb-1">âš ï¸ What's Not Working</p>
      <p className="text-neutral-200">{contrastText}</p>
    </div>
  )}
  
  {worryText && (
    <div>
      <p className="text-xs text-[#FF0040]/70 mb-1">ğŸ˜° Your Worries</p>
      <p className="text-neutral-200">{worryText}</p>
    </div>
  )}
  
  {!contrastText && !worryText && (
    <p className="text-neutral-400 text-sm">
      No contrast or worries recorded yet. Acknowledging contrast helps VIVA understand what to move away from.
    </p>
  )}
</Card>
```

### 3. ClarityFromContrastCard (Purple)

```tsx
<Card 
  variant="outlined" 
  className="border-[#BF00FF] bg-[#BF00FF]/5"
>
  <div className="flex items-center gap-2 mb-3">
    <div className="w-8 h-8 bg-[#BF00FF]/20 rounded-lg flex items-center justify-center">
      <Wand2 className="w-5 h-5 text-[#BF00FF]" />
    </div>
    <h3 className="text-lg font-semibold text-[#BF00FF]">
      Clarity from Contrast
    </h3>
    <Badge variant="premium" className="!bg-[#BF00FF]/20 !text-[#BF00FF] !border-[#BF00FF]/30">
      AI-Generated
    </Badge>
  </div>
  
  {clarityFromContrast ? (
    <p className="text-neutral-200">{clarityFromContrast}</p>
  ) : (
    <div className="space-y-2">
      <p className="text-neutral-400 text-sm">
        ğŸ”® VIVA will automatically generate clarity from your contrast and worries.
      </p>
      <p className="text-[#BF00FF]/70 text-xs italic">
        This helps transform "what's not working" into "what you truly want."
      </p>
    </div>
  )}
</Card>
```

## Data Flow

### 1. Loading Data (Frontend)

```typescript
// In /category/[key]/page.tsx
const loadExistingData = async () => {
  const { data: profile } = await supabase
    .from('user_profiles')
    .select('*')
    .eq('user_id', user.id)
    .eq('is_active', true)
    .single()
  
  const categoryKey = 'fun' // example
  
  // Load all 4 field types
  const clarity = profile?.[`clarity_${categoryKey}`] || ''
  const dream = profile?.[`dream_${categoryKey}`] || ''
  const contrast = profile?.[`contrast_${categoryKey}`] || ''
  const worry = profile?.[`worry_${categoryKey}`] || ''
  
  setProfileData({
    clarity,
    dream,
    contrast,
    worry,
    hasClarityData: clarity || dream,
    hasContrastData: contrast || worry
  })
}
```

### 2. Passing to VIVA (Clarity Prompt)

```typescript
// In /api/viva/clarity/route.ts
const contextData = {
  profile: {
    clarity: profile[`clarity_${category}`],
    dream: profile[`dream_${category}`],
    contrast: profile[`contrast_${category}`],
    worry: profile[`worry_${category}`]
  },
  assessment: assessmentData,
  transcript: userTranscript
}

// VIVA prompt includes:
// "User's existing clarity: [clarity]"
// "User's dreams: [dream]"
// "User's contrast: [contrast]"
// "User's worries: [worry]"
```

### 3. Contrast Flip Integration

When user triggers "Flip Contrast to Clarity":

```typescript
// In /api/viva/contrast-flip/route.ts
const flipContrastToClarity = async () => {
  const contrastData = {
    contrast: profile[`contrast_${category}`],
    worry: profile[`worry_${category}`]
  }
  
  // Call VIVA to flip
  const clarityFromContrast = await viva.flipContrast({
    contrast: contrastData.contrast,
    worry: contrastData.worry,
    category: categoryKey
  })
  
  // Store in life_vision_category_state
  await supabase
    .from('life_vision_category_state')
    .upsert({
      user_id: user.id,
      category: categoryKey,
      clarity_from_contrast: clarityFromContrast
    })
}
```

## Implementation Steps

### Phase 1: Design Tokens & Components

1. âœ… Add new colors to `src/lib/design-system/tokens.ts`:
   ```typescript
   neon: {
     cyan: '#00FFFF',
     red: '#FF0040'
   },
   premium: {
     purple: '#BF00FF'
   }
   ```

2. âœ… Create `ProfileClarityCard.tsx`
3. âœ… Create `ProfileContrastCard.tsx`
4. âœ… Create `ClarityFromContrastCard.tsx`

### Phase 2: Data Loading

5. âœ… Update `/category/[key]/page.tsx` to load all 4 fields
6. âœ… Add state management for clarity, dream, contrast, worry
7. âœ… Display the 3 cards in the UI

### Phase 3: VIVA Integration

8. âœ… Update `src/lib/viva/prompts/clarity-prompt.ts` to include all fields
9. âœ… Update `/api/viva/clarity/route.ts` to pass all context
10. âœ… Update assembly prompt to include all profile data

### Phase 4: Contrast Flip

11. âœ… Create `/api/viva/contrast-flip/route.ts`
12. âœ… Add "Flip Contrast" button to Contrast card
13. âœ… Store result in `life_vision_category_state.clarity_from_contrast`

### Phase 5: Testing

14. âœ… Test with profiles that have all fields populated
15. âœ… Test with profiles that have some fields missing
16. âœ… Test contrast flip functionality
17. âœ… Verify colors render correctly

## Database Schema Update

Add `clarity_from_contrast` to `life_vision_category_state`:

```sql
ALTER TABLE life_vision_category_state
ADD COLUMN clarity_from_contrast TEXT;

COMMENT ON COLUMN life_vision_category_state.clarity_from_contrast IS 
'AI-generated clarity flipped from user''s contrast and worries (Premium feature)';
```

## Expected User Experience

1. **User arrives at `/life-vision/new/category/fun`**
2. **Sees 3 cards with vibrant colors:**
   - Cyan card shows "what's going well" + dreams
   - Red card shows "what's not working" + worries
   - Purple card shows AI-generated clarity (or prompt to generate)
3. **User records audio/types their reflection**
4. **VIVA uses ALL context** (clarity + dream + contrast + worry + transcript + assessment) to create summary
5. **Result:** Much more emotionally intelligent, context-aware summary

## Benefits

âœ… **Richer Context** - VIVA knows aspirations AND concerns  
âœ… **Visual Clarity** - Color-coded cards make it easy to understand  
âœ… **Contrast Transformation** - Turn worries into clarity  
âœ… **Premium Feature** - Purple card signals AI magic  
âœ… **Comprehensive Understanding** - All 4 data points per category

## Files to Update

### New Files
- `src/lib/design-system/profile-cards/ProfileClarityCard.tsx`
- `src/lib/design-system/profile-cards/ProfileContrastCard.tsx`
- `src/lib/design-system/profile-cards/ClarityFromContrastCard.tsx`
- `src/app/api/viva/contrast-flip/route.ts`
- `supabase/migrations/YYYYMMDD_add_clarity_from_contrast.sql`

### Modified Files
- `src/lib/design-system/tokens.ts` (add neon colors)
- `src/app/life-vision/new/category/[key]/page.tsx` (display cards, load data)
- `src/lib/viva/prompts/clarity-prompt.ts` (include all fields)
- `src/app/api/viva/clarity/route.ts` (pass all context)
- `src/app/life-vision/new/assembly/page.tsx` (include all profile data)

## Color Usage Guidelines

**Neon Cyan (#00FFFF):**
- Borders, icon backgrounds, text highlights
- Use with 5-20% opacity backgrounds
- Represents alignment, clarity, dreams

**Neon Red (#FF0040):**
- Borders, icon backgrounds, warnings
- Use with 5-20% opacity backgrounds
- Represents contrast, awareness, transformation opportunity

**Premium Purple (#BF00FF):**
- AI-generated content
- Premium features
- Mystical, transformative moments
- Use with "AI" or "Premium" badges

## Next Steps

Ready to implement? This is a comprehensive enhancement that will:
- Make VIVA significantly smarter
- Provide better context for vision generation
- Turn contrast into growth opportunity
- Create a visually stunning, color-coded system

Want me to start building this? ğŸš€


